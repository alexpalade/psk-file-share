import{r as e,h as t,g as i}from"./p-1c0c10bb.js";import"./p-4a6e3791.js";import"./p-1dd23f18.js";import{T as o}from"./p-6a6d8fee.js";import{C as s}from"./p-3d63d30b.js";class r{static _prepareRoutesTree(e,t){let i=function(e){let o={};return e.forEach(e=>{let s=e.name.replace(/(\s+|-)/g,"").toLowerCase();if(!o[s]){let i=e.path;switch(t){case"browser":case"query":i=e.path;break;case"hash":i="/#"+e.path}o[s]={path:i}}if("object"==typeof e.children&&Array.isArray(e.children.items))o[s].children={type:"known",items:i(e.children.items)};else if("string"==typeof e.children&&0===e.children.indexOf("@event:")){let t=e.children.substring("@event:".length);o[s].children={type:"event",event:t}}}),o};return i(e)}static _prepareConfiguration(e,t){let i={};i.baseUrl=t;let o=t+e.basePagesUrl;if(e.modals&&(i.modals={},Object.keys(e.modals).length))for(let r in e.modals)i.modals[r]=o+e.modals[r];if(!e.menu||!e.menu.defaultMenuConfig)throw new Error("Default menu configuration is missing");let s=e.menu.defaultMenuConfig;e.profile&&(i.profile=e.profile);let n=function(e){for(let t=0;t<e.length;t++)e[t].children&&e[t].children.items?n(e[t].children.items):void 0!==e[t].indexed&&"false"===e[t].indexed.toString()&&e.splice(t,1);return e},a=function(e,t){return e.forEach(e=>{if(!e.path){let t=e.name.toLowerCase().toLowerCase().replace(/\s+/g,"-");t=t.replace(/[:\/]/g,""),e.path=t}if(0!==e.path.indexOf("/")&&(e.path="/"+e.path),t&&(e.path=t+e.path),e.children)e.type="abstract",e.icon||(e.icon=s.icon);else{for(let t in s)e.hasOwnProperty(t)||(e[t]=s[t]);if("psk-page-loader"===e.component)if(e.componentProps||(e.componentProps={}),Object.assign(e.componentProps,e.options),e.pageSrc)e.componentProps.pageUrl=e.pageSrc.startsWith("http")?e.pageSrc:o+e.pageSrc;else{let i=e.name.replace(/[:.!?]/g,"").replace(/\s/g,"-").toLowerCase(),s="";t&&(s=t.replace(/^\//,"")),0!==s.length&&(s+="/"),e.componentProps.pageUrl=o+s+i+".html"}}if("object"==typeof e.children&&Array.isArray(e.children))e.children={type:"known",items:JSON.parse(JSON.stringify(e.children))},a(e.children.items,e.path);else if("string"==typeof e.children&&0==e.children.indexOf("@event:")){let t=e.children.substring("@event:".length);e.children={type:"event",event:t},e.component="psk-ssapp-loader"}}),e};i.routes=a(e.menu.pages),i.historyType="browser";let l=e.menu.defaultMenuConfig.historyType;if("hash"!==l&&"query"!==l||(i.historyType=l),"query"===l){let t="?";e.menu.defaultMenuConfig.pagePrefix&&(t=e.menu.defaultMenuConfig.pagePrefix);let o=function(e){e.forEach(e=>{let i=e.path;0===i.indexOf("/")&&(i=i.substr(1)),e.path=`${t}${i}`,e.children&&o(e.children.items)})};o(i.routes)}let p=JSON.parse(JSON.stringify(i.routes));return i.menu=n(p),i.tags=function(e){let t=[];return function e(i){i.forEach(i=>{Object.prototype.hasOwnProperty.call(i,"tags")&&i.tags.split(",").map(e=>e.trim()).forEach(e=>{t[e]=i.path}),"object"==typeof i.children&&Array.isArray(i.children.items)&&e(i.children.items)})}(e),t}(p),i.pagesHierarchy=r._prepareRoutesTree(i.routes,l),i}}const n={theme:"default",appVersion:"1.0.0",basePagesUrl:"/pages/",profile:{username:"Cardinal App",email:"privatesky@axiologic.net",avatar:"https://privatesky.xyz/assets/images/privatesky.png"},menu:{defaultMenuConfig:{icon:"fa-bars",type:"route",component:"psk-page-loader",exact:!1,indexed:!0,historyType:"browser"},pages:[{name:"Home",path:"/home",pageSrc:"index.html"}]}};window.globalConfig={};class a{constructor(e){this.configIsLoaded=!1,this.pendingRequests=[],this._getAppConfiguration("/app-config.json",(e,t)=>{let i;for(i=window&&window.location&&window.location.origin?window.location.origin:t.baseUrl,this.configuration=r._prepareConfiguration(t,i),this.configuration.theme=t.theme,this.configuration.appVersion=t.appVersion,this.configIsLoaded=!0;this.pendingRequests.length;){let e=this.pendingRequests.pop();if(!this.configuration[e.configName])throw new Error(`Config ${e.configName} was not provided. Did you set it in app-config.json?`);e.callback(void 0,this.configuration[e.configName])}}),e.addEventListener("getThemeConfig",this._provideConfig("theme")),e.addEventListener("getAppVersion",this._provideConfig("appVersion")),e.addEventListener("needRoutes",this._provideConfig("routes")),e.addEventListener("needMenuItems",this._provideConfig("menu")),e.addEventListener("getUserInfo",this._provideConfig("profile")),e.addEventListener("getHistoryType",this._provideConfig("historyType")),e.addEventListener("getModals",this._provideConfig("modals")),e.addEventListener("getTags",this._provideConfig("tags")),e.addEventListener("validateUrl",e=>{e.stopImmediatePropagation();let{sourceUrl:t,callback:i}=e.detail;i&&"function"==typeof i?this._parseSourceUrl(t,i):console.error("Callback was not properly provided!")}),e.addEventListener("getCustomLandingPage",e=>{let t=e.detail;if(window.frameElement&&window.frameElement.hasAttribute("landing-page"))return t(void 0,window.frameElement.getAttribute("landing-page"));t()})}_provideConfig(e){return t=>{t.stopImmediatePropagation();let i=t.detail;if(i&&"function"==typeof i)if(this.configIsLoaded){if(!this.configuration[e])throw new Error(`Config ${e} was not provided`);i(void 0,this.configuration[e])}else this.pendingRequests.push({configName:e,callback:i})}}_parseSourceUrl(e,t){let i=(e=e.replace(/(\s+|-)/g,"").toLowerCase()).split("/"),o=this.configuration.pagesHierarchy;for(let s=0;s<i.length;s++){let r=i[s];const n=Object.keys(o).find((function(e){return-1!==o[e].path.toLowerCase().indexOf(r)}));let a,l,p=void 0!==o[n];if(!o[r]&&!p){t(e+" is not a valid path in the application!");break}if(a=p?o[n].children:o[r].children,"object"!=typeof a||"object"!=typeof a.items||s===i.length)return l=p?o[n].path:o[r].path,t(void 0,l);o=a.items}}_getAppConfiguration(e,t){let i=new XMLHttpRequest;i.open("GET",e),i.onload=()=>{if(200!=i.status)console.error("Configuration file app-config.json was not found!"),t(null,n);else{let e=JSON.parse(i.responseText);for(let t in n)e.hasOwnProperty(t)||(e[t]=n[t]);t(null,e)}},i.onerror=()=>{t(new Error("An error occurred"))},i.send()}}const l=class{constructor(t){e(this,t),this.mobileLayout=!1,this.componentCode="",this.hasSlot=!1}__createLoader(){let e="";for(let i=1;i<=12;i++)e+=`<div class="sk-circle${i} sk-circle"></div>`;let t=document.createElement("div");return t.className="app-loader",t.innerHTML=`<div class='sk-fading-circle'>${e}</div>`,t}connectedCallback(){this.disconnected=!1}disconnectedCallback(){this.disconnected=!0}componentWillLoad(){this.host.parentElement&&(this.htmlLoader=this.__createLoader(),this.host.parentElement.appendChild(this.htmlLoader));let e=this.host.innerHTML;if(e=e.replace(/\s/g,""),e.length&&(this.hasSlot=!0),"string"==typeof this.controller)return new Promise((e,t)=>{s.getController(this.controller).then(t=>{if(this.disconnected)return e();new t(this.host),e()}).catch(t)});new a(this.host)}componentDidLoad(){this.htmlLoader&&this.htmlLoader.parentNode&&this.htmlLoader.parentNode.removeChild(this.htmlLoader)}render(){return t(this.hasSlot?"slot":"psk-default-renderer",null)}get host(){return i(this)}};!function(e,t,i,o){var s,r=arguments.length,n=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(r<3?s(n):r>3?s(t,i,n):s(t,i))||n);r>3&&n&&Object.defineProperty(t,i,n)}([o({isMandatory:!1,description:["This property is a string that will permit the developer to choose his own controller.","If no controller is provided, a default controller will be passed to the component","It is recommended that each app to extend the provided default controller and adapt it to the application needs"],propertyType:"string",defaultValue:"null"})],l.prototype,"controller",void 0);export{l as psk_app_root}